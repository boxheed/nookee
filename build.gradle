buildscript {
	repositories {
		jcenter()
	}
	dependencies {
	  classpath "com.fizzpod:gradle-java-opinion:0.1.4"
		classpath "org.springframework.boot:spring-boot-gradle-plugin:1.3.1.RELEASE"
		classpath "io.spring.gradle:dependency-management-plugin:0.5.4.RELEASE"
		classpath 'com.fizzpod:gradle-pater-build-plugin:1.0.4'
		classpath 'com.netflix.nebula:gradle-ospackage-plugin:3.4.0'
	}
}

apply plugin: 'nebula.ospackage'
apply plugin: 'com.fizzpod.pater-build'
apply plugin: 'spring-boot'
apply plugin: 'io.spring.dependency-management'

description = """Net Hook Executor"""

sourceCompatibility = 1.7
targetCompatibility = 1.7



repositories {
     jcenter()
}

dependencyManagement {
	imports {
		 mavenBom 'org.springframework.boot:spring-boot-starter-parent:1.3.3.RELEASE'
	}
}

springBoot {
    executable = true
}

dependencies {
	compile group: 'org.springframework.boot', name: 'spring-boot-starter-actuator'
	compile group: 'org.springframework.boot', name: 'spring-boot-starter-web'
	compile group: 'commons-io', name: 'commons-io', version:'2.4'

	compile 'org.jruby:jruby-complete:9.0.5.0'
	compile 'org.codehaus.groovy:groovy-all:2.4.6'
	compile 'org.python:jython:2.7.0'




	testCompile group: 'org.springframework.boot', name: 'spring-boot-starter-test'
	testCompile group: 'junit', name: 'junit', version:'4.11'
	testCompile group: 'org.mockito', name: 'mockito-core', version:'1.9.5'
}

ext.installPath='/opt/fizzpod/' + archivesBaseName
ext.jarPath=installPath + '/' + archivesBaseName + '-' + scmVersion.version + '.jar'
ext.initPath='/etc/init.d/' + archivesBaseName
artifacts {
	archives buildRpm
}

ospackage {
  	packageName = archivesBaseName
  	version = project.version.replaceAll("-", ".")
  	release = 1
  	arch = NOARCH
  	os = LINUX
  	user = archivesBaseName
  	group = archivesBaseName

  	into installPath

  	from(jar.outputs.files) {
  		fileMode 0500
  	}

    link(initPath, jarPath)

}

task distRpm(type: Rpm, dependsOn: bootRepackage) {}

assemble.dependsOn distRpm

publishing {
    publications {
        mavenRpm(MavenPublication) {
            artifact buildRpm
        }
    }
}

bintray {
	dryRun = false
	publish = true
	publications = ['mavenJava', 'mavenRpm']
	pkg {
		labels = ['gradle', 'opinion', 'gradle-pater-build-plugin', 'java']
		repo = 'maven'
	}
}
